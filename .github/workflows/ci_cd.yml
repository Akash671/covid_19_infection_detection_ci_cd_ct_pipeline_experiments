jobs:
  train_and_update_model:
    runs-on: ubuntu-latest
    
    # ðŸ’¥ CRITICAL FIX #1: Grant Write Permissions to the GITHUB_TOKEN for this job.
    permissions:
      contents: write 
      
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          # CRITICAL FIX #2: Explicitly provide the GITHUB_TOKEN.
          # This token now carries the 'contents: write' permission granted above,
          # allowing the 'git push' command later in the 'run' block to succeed.
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0 # Fetches full history, required for git push
          
      - name: Setup Python environment
        uses: actions/setup-python@v5
        # ... other setup steps ...

      - name: Run training and commit changes
        run: |
          # 1. Configuration (Required for commit)
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          
          # 2. Run the training script (which creates the model artifact)
          python -m training.train  
          
          # 3. Commit the new artifact
          git add model_artifacts/model_20251118_152002.pkl
          git commit -m "CI/CD: Updated model via training pipeline [skip ci]"
          
          # 4. Push the changes (This now succeeds)
          git push